{{template "base" .}}

{{define "title"}}Settings - Kube Sentinel{{end}}

{{define "content"}}
<div class="space-y-6">
    <h1 class="text-2xl font-bold text-gray-900">Settings</h1>

    <!-- Remediation Settings -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-medium text-gray-900 mb-4">Remediation Settings</h2>
        <form id="settings-form" class="space-y-4">
            <div class="flex items-center justify-between">
                <div>
                    <label class="text-sm font-medium text-gray-900">Enable Remediation</label>
                    <p class="text-sm text-gray-500">Allow automatic remediation actions</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="rem-enabled" class="sr-only peer" {{if .RemEnabled}}checked{{end}}>
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
            </div>

            <div class="flex items-center justify-between">
                <div>
                    <label class="text-sm font-medium text-gray-900">Dry Run Mode</label>
                    <p class="text-sm text-gray-500">Log actions without executing them</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="dry-run" class="sr-only peer" {{if .DryRun}}checked{{end}}>
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-yellow-500"></div>
                </label>
            </div>

            <div class="pt-4">
                <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                    Save Settings
                </button>
                <span id="save-result" class="ml-4 text-sm"></span>
            </div>
        </form>
    </div>

    <!-- Status -->
    <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-medium text-gray-900 mb-4">Current Status</h2>
        <dl class="space-y-3">
            <div class="flex items-center justify-between">
                <dt class="text-sm font-medium text-gray-500">Remediation Status</dt>
                <dd>
                    {{if .RemEnabled}}
                        {{if .DryRun}}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">Dry Run</span>
                        {{else}}
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">Active</span>
                        {{end}}
                    {{else}}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">Disabled</span>
                    {{end}}
                </dd>
            </div>
            <div class="flex items-center justify-between">
                <dt class="text-sm font-medium text-gray-500">Actions This Hour</dt>
                <dd class="text-sm text-gray-900">{{.ActionsThisHour}}</dd>
            </div>
        </dl>
    </div>

    <!-- Info -->
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <h3 class="text-sm font-medium text-blue-800">Configuration Notes</h3>
        <ul class="mt-2 text-sm text-blue-700 list-disc list-inside space-y-1">
            <li>Other settings (Loki URL, poll interval, excluded namespaces) are configured via <code class="bg-blue-100 px-1 rounded">config.yaml</code></li>
            <li>Rules are configured via <code class="bg-blue-100 px-1 rounded">rules.yaml</code></li>
            <li>Changes to config files require a restart to take effect</li>
        </ul>
    </div>
</div>

<script>
document.getElementById('settings-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const result = document.getElementById('save-result');

    try {
        const resp = await fetch('/api/settings', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                enabled: document.getElementById('rem-enabled').checked,
                dry_run: document.getElementById('dry-run').checked
            })
        });

        if (resp.ok) {
            result.innerHTML = '<span class="text-green-600">Settings saved!</span>';
            setTimeout(() => { result.innerHTML = ''; }, 3000);
        } else {
            result.innerHTML = '<span class="text-red-600">Failed to save settings</span>';
        }
    } catch (e) {
        result.innerHTML = `<span class="text-red-600">Error: ${e.message}</span>`;
    }
});
</script>
{{end}}
